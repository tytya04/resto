# Изменения от 31.07.2025

## Проблема
Пользователь сообщил, что бот добавляет несуществующие продукты вместо предложения вариантов из базы. 
Пример: при вводе "Черри" бот должен предложить "Помидор черри стандарт", "Помидор черри отбор" и т.д.

## Проведенное исследование

### 1. Проверка базы данных
- Продукт "Черри" НЕ существует как отдельный продукт
- В базе есть синоним: "черри" → "Помидоры черри"
- Существуют варианты: "Помидоры черри", "Помидор черри стандарт", "Помидор черри отбор"

### 2. Проверка работы ProductMatcher
- `findExactMatch("Черри")` корректно находит "Помидоры черри" через синоним
- `suggestProducts("Черри")` правильно предлагает 3 варианта черри

### 3. Проверка логики добавления продуктов
- При распознавании ProductMatcher работает корректно
- Нераспознанные продукты добавляются со статусом 'unmatched' 
- Они НЕ добавляются в каталог nomenclature_cache
- При отправке заказа включаются только продукты со статусом 'matched' или 'confirmed'

## Внесенные изменения

### 1. Улучшение UX при просмотре черновика (src/handlers/draftOrder.js)
- Добавлено предупреждение для нераспознанных продуктов:
  ```
  ❓ Требуют уточнения:
  Эти продукты не найдены в каталоге и НЕ будут отправлены в заказе
  ```
- Изменена кнопка отправки при наличии нераспознанных продуктов:
  ```
  ⚠️ Отправить только подтвержденные
  ```

### 2. Улучшение сообщений при добавлении продуктов (src/handlers/draftOrder.js)
- При нераспознанном продукте добавлены четкие предупреждения:
  ```
  ❓ Продукт "Черри" не найден в каталоге
  ⚠️ Новые продукты может добавлять только менеджер.
  ```

## Выводы

1. **Система работает корректно** - новые продукты НЕ добавляются в каталог автоматически
2. **Проблема была в UX** - пользователю было непонятно, что нераспознанные продукты не попадут в заказ
3. **Внесенные изменения** улучшают понимание работы системы пользователями

## Рекомендации

1. Обучить пользователей использовать точные названия из каталога
2. Регулярно обновлять синонимы для часто используемых сокращений
3. Рассмотреть возможность добавления функции "запроса на добавление продукта" для ресторанов